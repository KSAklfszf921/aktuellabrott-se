<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Offline - Polish√§ndelser Sverige</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #1e40af 0%, #3b82f6 50%, #8b5cf6 100%);
      color: #1e293b;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      margin: 0;
      padding: 20px;
      box-sizing: border-box;
    }

    .offline-container {
      text-align: center;
      max-width: 500px;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      padding: 60px 40px;
      border-radius: 24px;
      box-shadow:
        0 10px 15px -3px rgba(0, 0, 0, 0.1),
        0 4px 6px -2px rgba(0, 0, 0, 0.05),
        inset 0 1px 0 rgba(255, 255, 255, 0.6);
      border: 1px solid rgba(255, 255, 255, 0.3);
    }

    .offline-icon {
      font-size: 6rem;
      margin-bottom: 30px;
      animation: float 3s ease-in-out infinite;
    }

    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }

    h1 {
      color: #1e40af;
      margin-bottom: 20px;
      font-size: 2rem;
      font-weight: 800;
      background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
      background-clip: text;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    p {
      color: #64748b;
      line-height: 1.6;
      margin-bottom: 30px;
      font-size: 1.1rem;
    }

    .retry-btn {
      background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
      color: white;
      border: none;
      padding: 16px 32px;
      border-radius: 12px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      margin-bottom: 30px;
    }

    .retry-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    }

    .retry-btn:active {
      transform: translateY(0);
    }

    .status {
      margin-top: 30px;
      font-size: 0.9rem;
      color: #9ca3af;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      animation: pulse 2s infinite;
    }

    .status.offline .status-dot {
      background: #ef4444;
    }

    .status.online .status-dot {
      background: #10b981;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .cached-data-info {
      background: rgba(59, 130, 246, 0.1);
      border: 1px solid rgba(59, 130, 246, 0.3);
      border-radius: 12px;
      padding: 20px;
      margin-top: 30px;
      text-align: left;
    }

    .cached-data-info h3 {
      margin: 0 0 10px;
      color: #1e40af;
      font-size: 1rem;
    }

    .cached-data-info p {
      margin: 0;
      font-size: 0.9rem;
      color: #64748b;
    }

    .features {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-top: 30px;
    }

    .feature {
      padding: 20px;
      background: rgba(255, 255, 255, 0.7);
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.5);
    }

    .feature-icon {
      font-size: 2rem;
      margin-bottom: 10px;
    }

    .feature h4 {
      margin: 0 0 8px;
      color: #1e40af;
      font-size: 0.95rem;
    }

    .feature p {
      margin: 0;
      font-size: 0.8rem;
      color: #64748b;
    }
  </style>
</head>
<body>
  <div class="offline-container">
    <div class="offline-icon">üì°</div>
    <h1>Du √§r offline</h1>
    <p>Polish√§ndelser-kartan kr√§ver internetuppkoppling f√∂r att visa aktuell data. Du kan fortfarande anv√§nda tidigare h√§mtad data och all funktionalitet kommer att √•terst√§llas n√§r anslutningen √§r tillbaka.</p>

    <button class="retry-btn" onclick="window.location.reload()">
      F√∂rs√∂k igen
    </button>

    <div class="status offline" id="connection-status">
      <div class="status-dot"></div>
      <span>Ingen internetanslutning</span>
    </div>

    <div class="cached-data-info">
      <h3>üíæ Lokalt lagrad data</h3>
      <p>Dina senast h√§mtade polish√§ndelser och favoriter √§r fortfarande tillg√§ngliga. All funktionalitet √•terst√§lls automatiskt n√§r du √§r online igen.</p>
    </div>

    <div class="features">
      <div class="feature">
        <div class="feature-icon">üó∫Ô∏è</div>
        <h4>Offline-karta</h4>
        <p>Senast visade kartomr√•de √§r tillg√§ngligt offline</p>
      </div>
      <div class="feature">
        <div class="feature-icon">‚≠ê</div>
        <h4>Favoriter</h4>
        <p>Dina sparade h√§ndelser och platser finns kvar</p>
      </div>
      <div class="feature">
        <div class="feature-icon">üìä</div>
        <h4>Statistik</h4>
        <p>Tidigare statistik och analyser √§r tillg√§ngliga</p>
      </div>
    </div>
  </div>

  <script>
    function updateConnectionStatus() {
      const status = document.getElementById('connection-status');
      const statusDot = status.querySelector('.status-dot');
      const statusText = status.querySelector('span');

      if (navigator.onLine) {
        status.className = 'status online';
        statusText.textContent = 'Anslutning √•terst√§lld - laddar om...';
        // Auto-reload when back online
        setTimeout(() => {
          window.location.href = '/';
        }, 2000);
      } else {
        status.className = 'status offline';
        statusText.textContent = 'Ingen internetanslutning';
      }
    }

    // Update status on load and when connection changes
    updateConnectionStatus();
    window.addEventListener('online', updateConnectionStatus);
    window.addEventListener('offline', updateConnectionStatus);

    // Try to load cached data from IndexedDB
    async function loadCachedData() {
      try {
        if ('indexedDB' in window) {
          const request = indexedDB.open('AktuellaBrottDB', 2);
          request.onsuccess = (event) => {
            const db = event.target.result;
            const transaction = db.transaction(['events'], 'readonly');
            const store = transaction.objectStore('events');
            const countRequest = store.count();

            countRequest.onsuccess = () => {
              const count = countRequest.result;
              if (count > 0) {
                const cachedInfo = document.querySelector('.cached-data-info p');
                cachedInfo.innerHTML = `Du har ${count} sparade polish√§ndelser tillg√§ngliga offline. <a href="/" style="color: #1e40af; text-decoration: underline;">G√• till kartan</a> f√∂r att visa dem.`;
              }
            };
          };
        }
      } catch (error) {
        console.log('Could not access cached data:', error);
      }
    }

    loadCachedData();

    // Add keyboard shortcut for reload
    document.addEventListener('keydown', (event) => {
      if (event.key === 'r' && (event.ctrlKey || event.metaKey)) {
        event.preventDefault();
        window.location.reload();
      }
    });
  </script>
</body>
</html>